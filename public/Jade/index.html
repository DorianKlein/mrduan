<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>珍品鉴赏 - 3D 展示</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+SC:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script>

    <style>
        body {
            font-family: 'Noto Serif SC', serif;
            overflow: hidden;
            background-color: #f0f0f0;
            background: radial-gradient(circle at center, #333333 0%, #000000 100%);
            color: #e5e7eb;
            /* 禁止文字选中 */
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #111;
            z-index: 50;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: opacity 1s ease;
        }

        .info-card {
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(10px);
            border-left: 3px solid #10b981;
        }
    </style>
</head>
<body class="relative h-screen w-screen">

    <!-- 加载遮罩 -->
    <div id="loader">
        <div class="text-center">
            <h2 class="text-2xl text-emerald-500 mb-2 tracking-widest">正在布置展台</h2>
            <p id="loading-text" class="text-gray-500 text-sm">智能寻址中...</p>
            <p id="loading-debug" class="text-gray-600 text-xs mt-2 font-mono"></p>
        </div>
    </div>

    <!-- UI 层 -->
    <div class="absolute top-0 left-0 p-8 z-10 w-full md:w-1/3 pointer-events-none">
        <h1 class="text-4xl font-bold mb-2 text-white tracking-widest">珍品鉴赏</h1>
        <p class="text-emerald-400/80 text-sm mb-6 tracking-wider uppercase border-b border-gray-600 pb-4 inline-block">Exclusive Artifact Exhibition</p>
        
        <div id="info-panel" class="info-card p-6 rounded-r-lg transition-all duration-500 transform pointer-events-auto">
            <h2 id="artifact-title" class="text-2xl font-bold text-white mb-2">大C龙</h2>
            <p id="artifact-desc" class="text-gray-300 leading-relaxed text-sm text-justify">
                正在展示您的专属藏品。
            </p>
            <div class="mt-4 flex gap-4 text-xs text-emerald-500/90">
                <span id="artifact-material">✦ 材质：高精度3D扫描 / 岫岩玉</span>
            </div>
        </div>
    </div>

    <div class="absolute bottom-8 right-8 z-10 hidden md:block pointer-events-none">
        <div class="text-right text-gray-400 text-xs space-y-1">
            <p>左键旋转 • 滚轮缩放 • 右键平移</p>
            <p>WebGL 3D Viewer</p>
        </div>
    </div>

    <canvas id="webgl-canvas" class="outline-none"></canvas>

    <script>
        // === 1. 初始化场景 ===
        const canvas = document.querySelector('#webgl-canvas');
        const scene = new THREE.Scene();
        scene.fog = new THREE.FogExp2(0x111111, 0.02);

        const sizes = {
            width: window.innerWidth,
            height: window.innerHeight
        };

        const camera = new THREE.PerspectiveCamera(45, sizes.width / sizes.height, 0.1, 100);
        // === 调整相机位置：Y轴拉高 (8 -> 10)，Z轴稍微拉远一点点以保持整体感，形成俯视视角 ===
        camera.position.set(0, 10, 16); 
        scene.add(camera);

        const renderer = new THREE.WebGLRenderer({
            canvas: canvas,
            antialias: true,
            alpha: true
        });
        renderer.setSize(sizes.width, sizes.height);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.physicallyCorrectLights = true;
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.8;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;

        // === 2. 交互控制 ===
        const controls = new THREE.OrbitControls(camera, canvas);
        controls.enableDamping = true;
        controls.dampingFactor = 0.05;
        controls.minDistance = 2;
        controls.maxDistance = 25;
        controls.autoRotate = true;
        controls.autoRotateSpeed = 0.8;
        controls.target.set(0, 1.5, 0);

        // === 3. 灯光系统 ===
        const ambientLight = new THREE.AmbientLight(0xffffff, 2);
        scene.add(ambientLight);

        const spotLight = new THREE.SpotLight(0xfffff0, 15);
        spotLight.position.set(5, 12, 8);
        spotLight.angle = Math.PI / 5;
        spotLight.penumbra = 0.3;
        spotLight.castShadow = true;
        spotLight.shadow.bias = -0.0001;
        spotLight.shadow.mapSize.width = 2048;
        spotLight.shadow.mapSize.height = 2048;
        scene.add(spotLight);

        const fillLight1 = new THREE.DirectionalLight(0xcceeff, 4);
        fillLight1.position.set(-8, 2, 2);
        scene.add(fillLight1);

        const fillLight2 = new THREE.DirectionalLight(0xffeedd, 3);
        fillLight2.position.set(8, 2, -2);
        scene.add(fillLight2);
        
        const backLight = new THREE.PointLight(0xffffff, 5, 15);
        backLight.position.set(0, 3, -5);
        scene.add(backLight);

        // === 4. 创建展台 ===
        const pedestalGroup = new THREE.Group();
        scene.add(pedestalGroup);

        const baseMaterial = new THREE.MeshPhysicalMaterial({
            color: 0x3d231d,  
            roughness: 0.3,   
            metalness: 0.1,   
            clearcoat: 0.4,   
            clearcoatRoughness: 0.2
        });

        const mainBaseGeo = new THREE.CylinderGeometry(3.5, 3.8, 1.2, 64);
        const mainBase = new THREE.Mesh(mainBaseGeo, baseMaterial);
        mainBase.position.y = -0.6; 
        mainBase.receiveShadow = true;
        pedestalGroup.add(mainBase);

        const topPlateGeo = new THREE.CylinderGeometry(3.6, 3.6, 0.15, 64);
        const topPlate = new THREE.Mesh(topPlateGeo, baseMaterial);
        topPlate.position.y = 0.075; 
        topPlate.receiveShadow = true;
        pedestalGroup.add(topPlate);
        
        const ringGeo = new THREE.TorusGeometry(3.55, 0.04, 16, 100);
        const ringMat = new THREE.MeshStandardMaterial({ 
            color: 0xcca352,
            roughness: 0.2,
            metalness: 0.8
        });
        const ring = new THREE.Mesh(ringGeo, ringMat);
        ring.rotation.x = Math.PI / 2;
        ring.position.y = -0.05; 
        pedestalGroup.add(ring);


        // === 5. 智能模型加载系统 (Smart Loader) ===
        
        const displayGroup = new THREE.Group();
        scene.add(displayGroup);
        const gltfLoader = new THREE.GLTFLoader();

        // 关键：定义可能的文件路径列表
        // 1. Jade-long.glb: 适用于当前目录（通用）
        // 2. /Jade/Jade-long.glb: 适用于 Next.js Public 目录标准路径
        // 3. /Jade-long.glb: 适用于文件意外在根目录的情况
        const candidatePaths = [
            'Jade-long.glb',
            '/Jade/Jade-long.glb',
            '/Jade-long.glb'
        ];

        let loadedSuccessfully = false;

        function loadModelRecursively(pathIndex) {
            if (pathIndex >= candidatePaths.length) {
                // 所有路径都失败了
                handleLoadError("所有路径均尝试失败");
                return;
            }

            const currentPath = candidatePaths[pathIndex];
            const debugText = document.getElementById('loading-debug');
            debugText.innerText = `尝试路径 [${pathIndex+1}/${candidatePaths.length}]: ${currentPath}`;
            
            console.log(`正在尝试加载: ${currentPath}`);

            gltfLoader.load(
                currentPath,
                (gltf) => {
                    // === 成功 ===
                    loadedSuccessfully = true;
                    console.log(`成功加载模型，路径为: ${currentPath}`);
                    
                    const model = gltf.scene;
                    const box = new THREE.Box3().setFromObject(model);
                    const size = box.getSize(new THREE.Vector3());
                    const center = box.getCenter(new THREE.Vector3());
                    
                    const maxDim = Math.max(size.x, size.y, size.z);
                    const scaleFactor = 5.0 / maxDim;
                    
                    model.scale.set(scaleFactor, scaleFactor, scaleFactor);
                    model.position.x = -center.x * scaleFactor;
                    model.position.y = -center.y * scaleFactor + (size.y * scaleFactor / 2) + 0.25; 
                    model.position.z = -center.z * scaleFactor;

                    model.traverse((child) => {
                        if (child.isMesh) {
                            child.castShadow = true;
                            child.receiveShadow = true;
                            if (child.material) {
                                child.material.envMapIntensity = 2.0; 
                                child.material.needsUpdate = true;
                            }
                        }
                    });

                    displayGroup.add(model);
                    document.getElementById('artifact-desc').innerText = "模型加载完毕。通过鼠标拖拽可全方位欣赏细节。";
                    hideLoader();
                },
                undefined, // Progress
                (error) => {
                    // === 失败，尝试下一个 ===
                    console.warn(`路径 ${currentPath} 加载失败，尝试下一个...`);
                    loadModelRecursively(pathIndex + 1);
                }
            );
        }

        // 启动加载链
        loadModelRecursively(0);


        function handleLoadError(msg) {
            const loadingText = document.getElementById('loading-text');
            const debugText = document.getElementById('loading-debug');
            loadingText.innerText = "加载失败: 未找到模型文件";
            loadingText.style.color = "#ef4444";
            debugText.innerText = "请检查：1.文件名大小写是否一致 2.public/Jade文件夹是否存在";
            
            // 加载替代品
            const fallbackGeo = new THREE.IcosahedronGeometry(2, 0);
            const fallbackMat = new THREE.MeshPhysicalMaterial({ 
                color: 0x10b981, 
                wireframe: true,
                emissive: 0x002211
            });
            const fallback = new THREE.Mesh(fallbackGeo, fallbackMat);
            fallback.position.y = 2.0;
            displayGroup.add(fallback);
            
            setTimeout(hideLoader, 2000); // 延迟关闭以便用户看到报错
        }

        function hideLoader() {
            const loader = document.getElementById('loader');
            loader.style.opacity = '0';
            setTimeout(() => {
                loader.style.display = 'none';
            }, 1000);
        }

        // === 6. 动画循环 ===
        const clock = new THREE.Clock();

        const tick = () => {
            const elapsedTime = clock.getElapsedTime();
            controls.update();
            renderer.render(scene, camera);
            window.requestAnimationFrame(tick);
        };

        window.addEventListener('resize', () => {
            sizes.width = window.innerWidth;
            sizes.height = window.innerHeight;
            camera.aspect = sizes.width / sizes.height;
            camera.updateProjectionMatrix();
            renderer.setSize(sizes.width, sizes.height);
            renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        });

        tick();
    </script>
</body>
</html>