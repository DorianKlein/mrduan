<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>æ”¶ä»¶ç®±çˆ†æ»¡ä¸­...</title>
    <style>
        /* === å…¨å±€æ ·å¼ï¼šå¥¶ä¹ä¹çš„èƒŒæ™¯ === */
        body {
            background-color: #fdf6e3; /* é»˜è®¤ç±³ç™½è‰²ï¼Œå¾ˆæ¸©æŸ” */
            margin: 0;
            overflow: hidden; 
            font-family: "Varela Round", "Comic Sans MS", "å¹¼åœ†", sans-serif; /* ç”¨åœ†æ¶¦çš„å­—ä½“ */
            touch-action: none;
        }

        /* === é©¬å¡é¾™çª—å£æ ·å¼ === */
        .window {
            position: absolute;
            /* é¢œè‰²ä¼šåœ¨JSé‡Œéšæœºèµ‹äºˆï¼Œè¿™é‡Œåªå†™åŸºç¡€ç»“æ„ */
            background: #fff; 
            border: 3px solid #fff;
            border-radius: 20px; /* åœ†è§’å¤§ä¸€ç‚¹ */
            box-shadow: 5px 5px 0px rgba(0,0,0,0.1); /* è¿™ç§æ‰å¹³æŠ•å½±å¾ˆåƒè´´çº¸ */
            width: 220px; /* ç¨å¾®åšå°ä¸€ç‚¹ï¼Œæ–¹ä¾¿å¯†é›†å †å  */
            display: flex;
            flex-direction: column;
            user-select: none;
            opacity: 0; 
            transform: scale(0.5);
            /* Qå¼¹çš„åŠ¨ç”»æ•ˆæœ */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); 
        }

        .window.show {
            opacity: 1;
            transform: scale(1) rotate(var(--rotation)); /* å¢åŠ éšæœºæ—‹è½¬ */
        }

        /* é¡¶éƒ¨å°æ¡ */
        .window-header {
            padding: 8px 15px 0 15px;
            display: flex;
            justify-content: flex-end;
        }

        .close-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255, 0.8);
            cursor: pointer;
        }

        /* å†…å®¹åŒºåŸŸ */
        .window-body {
            padding: 5px 15px 15px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555; /* å­—ä½“é¢œè‰²æ·±ç°ï¼Œä¸åˆºçœ¼ */
        }

        .emoji {
            font-size: 28px;
        }

        .text {
            font-size: 15px;
            font-weight: bold;
            line-height: 1.4;
        }

        /* === æœ€ç»ˆå¤§å¡ç‰‡ === */
        #final-card {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            background: #fff;
            border-radius: 30px;
            padding: 30px;
            text-align: center;
            z-index: 9999;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            animation: popUp 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        @keyframes popUp {
            from { transform: translate(-50%, -50%) scale(0); }
            to { transform: translate(-50%, -50%) scale(1); }
        }

        .btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: bold;
            margin-top: 15px;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 107, 107, 0.4);
        }
    </style>
</head>
<body>

    <div id="final-card">
        <h2 id="card-to" style="color: #ff8888; margin:0 0 10px 0;">To: å°å¯çˆ±</h2>
        <p id="card-msg" style="font-size: 18px; color: #666; margin-bottom: 20px;">è¿™é‡Œæ˜¯ä¸»ç¥ç¦è¯­</p>
        
    </div>

    <script>
        // === 1. é©¬å¡é¾™è‰²ç›˜ (èƒŒæ™¯è‰², è¾¹æ¡†è‰²ä¼šç¨æ·±ä¸€ç‚¹) ===
        const palettes = [
            { bg: "#FFB7B2", text: "#FFFFFF" }, // æ¡ƒç²‰
            { bg: "#FFDAC1", text: "#555555" }, // æé»„
            { bg: "#E2F0CB", text: "#555555" }, // æŠ¹èŒ¶
            { bg: "#B5EAD7", text: "#555555" }, // è–„è·
            { bg: "#C7CEEA", text: "#FFFFFF" }, // è“ç´«
            { bg: "#fff0f5", text: "#555555" }, // æ·¡ç²‰
            { bg: "#e0ffff", text: "#555555" }  // æ·¡è“
        ];

        const wishes = [
            "è¶…çº§è¶…çº§å–œæ¬¢ä½ !", "ä»Šå¤©ä¹Ÿè¦å¼€å¿ƒå‘€", "å¥½è¿æ­£åœ¨æ´¾é€ä¸­...", 
            "è®°å¾—æƒ³æˆ‘å“¦", "ä½ æœ€å¯çˆ±å•¦", "ç™¾äº‹å¯ä¹", "ä¸‡äº‹èƒœæ„", 
            "æš´å¯Œ! æš´ç˜¦!", "å¤©å¤©å¥½å¿ƒæƒ…", "æœªæ¥å¯æœŸ", "æ˜Ÿæ²³æ»šæ»šä¸å¦‚ä½ ",
            "ä¹–ä¹–åƒé¥­", "ä¸è®¸ç†¬å¤œ!", "æƒ³å¸¦ä½ å»åƒå¥½åƒçš„"
        ];
        
        const emojis = ["ğŸ’–", "ğŸŒˆ", "âœ¨", "ğŸ“", "ğŸ§¸", "ğŸˆ", "ğŸ­", "ğŸ¬", "ğŸ€", "ğŸ¦„"];

        // === 2. URL å‚æ•°è·å– ===
        const params = new URLSearchParams(window.location.search);
        const toName = params.get('to') || "æ˜Šæ¡å§å§";
        const mainMsg = params.get('msg') || "è¿™æ˜¯ä¸€ä¸ªè¶…çº§æ— æ•Œå¥½çœ‹çš„æ¼‚äº®å§å§ï¼";

        // === 3. ç–¯ç‹‚å¼¹çª—é€»è¾‘ ===
        let count = 0;
        const totalPopups = 50; // æ•°é‡åŠ åˆ° 50 ä¸ªï¼
        const screenW = window.innerWidth;
        const screenH = window.innerHeight;

        function createPopup() {
            if (count >= totalPopups) {
                setTimeout(showFinalCard, 500);
                return;
            }

            const div = document.createElement('div');
            div.className = 'window';
            
            // éšæœºé…è‰²
            const palette = palettes[Math.floor(Math.random() * palettes.length)];
            div.style.backgroundColor = palette.bg;
            div.style.color = palette.text;
            
            // éšæœºæ—‹è½¬è§’åº¦ (-10åº¦ åˆ° 10åº¦)ï¼Œå¢åŠ æ´»æ³¼æ„Ÿ
            const rotate = (Math.random() * 20 - 10).toFixed(2);
            div.style.setProperty('--rotation', rotate + 'deg');

            // éšæœºä½ç½® (å…è®¸ç¨å¾®é‡å ï¼Œåˆ¶é€ å †ç§¯æ„Ÿ)
            const x = Math.random() * (screenW - 220); // å‡å»å®½åº¦é˜²æ­¢è¶…å‡ºå»
            const y = Math.random() * (screenH - 150);
            div.style.left = x + "px";
            div.style.top = y + "px";
            div.style.zIndex = 100 + count;

            // éšæœºå†…å®¹
            const txt = wishes[Math.floor(Math.random() * wishes.length)];
            const emj = emojis[Math.floor(Math.random() * emojis.length)];

            div.innerHTML = `
                <div class="window-header">
                    <div class="close-dot"></div>
                </div>
                <div class="window-body">
                    <div class="emoji">${emj}</div>
                    <div class="text">${txt}</div>
                </div>
            `;

            document.body.appendChild(div);

            // è§¦å‘åŠ¨ç”»
            requestAnimationFrame(() => {
                div.classList.add('show');
            });

            count++;
            
            // === æé€Ÿæ¨¡å¼ ===
            // åˆå§‹å¾ˆå¿«ï¼Œä¸­é—´æå¿«ï¼Œæœ€åç¨å¾®æ…¢ä¸€ç‚¹ç‚¹æ”¶å°¾
            // éšæœºé—´éš” 50ms åˆ° 150msï¼Œåƒæœºå…³æªä¸€æ ·å¼¹
            let nextTime = Math.random() * 100 + 50; 
            setTimeout(createPopup, nextTime);
        }

        function showFinalCard() {
            const card = document.getElementById('final-card');
            document.getElementById('card-to').innerText = `To: ${toName}`;
            document.getElementById('card-msg').innerText = mainMsg;
            card.style.display = 'block';
        }

        // === å¯åŠ¨ ===
        window.onload = function() {
            setTimeout(createPopup, 300); // æ‰“å¼€ç½‘é¡µ 0.3ç§’åç›´æ¥å¼€å§‹
        };

    </script>
</body>
</html>