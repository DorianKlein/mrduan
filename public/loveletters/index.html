<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Incoming Love... üíå</title>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka:wght@400;600&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>

    <style>
        /* === Global Styles: Creamy Background === */
        body {
            background-color: #fdf6e3;
            /* Default creamy white, very gentle */
            margin: 0;
            overflow: hidden;
            font-family: 'Fredoka', 'Varela Round', sans-serif;
            touch-action: none;
        }

        /* === Macaron Window Styles === */
        .window {
            position: absolute;
            /* Colors will be assigned randomly in JS, here just the basic structure */
            background: #fff;
            border: 3px solid #fff;
            border-radius: 20px;
            /* Larger border radius */
            box-shadow: 5px 5px 0px rgba(0, 0, 0, 0.1);
            /* Flat shadow looks like a sticker */
            width: 220px;
            /* Slightly smaller to allow dense stacking */
            display: flex;
            flex-direction: column;
            user-select: none;
            opacity: 0;
            transform: scale(0.5);
            /* Bouncy animation effect */
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .window.show {
            opacity: 1;
            transform: scale(var(--scale, 1)) rotate(var(--rotation));
            /* Add random rotation and scale */
        }

        /* Top bar */
        .window-header {
            padding: 8px 15px 0 15px;
            display: flex;
            justify-content: flex-end;
        }

        .close-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.8);
            cursor: pointer;
        }

        /* Content area */
        .window-body {
            padding: 5px 15px 15px 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            color: #555;
            /* Dark gray font color, easy on the eyes */
        }

        .emoji {
            font-size: 28px;
        }

        .text {
            font-size: 15px;
            font-weight: bold;
            line-height: 1.4;
        }

        /* === Final Big Card & Overlay === */
        #final-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(253, 246, 227, 0.4);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            z-index: 9998;
            opacity: 0;
            transition: opacity 1s ease;
        }

        #final-card {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0.8);
            width: 85%;
            max-width: 420px;
            background: #fff;
            border-radius: 40px;
            padding: 50px 20px;
            text-align: center;
            z-index: 9999;
            box-shadow: 0 30px 100px rgba(255, 107, 107, 0.15);
            opacity: 0;
            transition: all 1s cubic-bezier(0.19, 1, 0.22, 1);
            border: 8px solid #FFE4E1;
            box-sizing: border-box;
        }

        #final-card.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .card-icon {
            font-size: 80px;
            margin-bottom: 20px;
            display: block;
            filter: drop-shadow(0 10px 15px rgba(255, 107, 107, 0.2));
            animation: heartBeat 2s ease-in-out infinite;
        }

        @keyframes heartBeat {
            0% {
                transform: scale(1);
            }

            14% {
                transform: scale(1.15);
            }

            28% {
                transform: scale(1);
            }

            42% {
                transform: scale(1.15);
            }

            70% {
                transform: scale(1);
            }
        }

        #card-to {
            font-family: 'Fredoka', sans-serif;
            font-weight: 600;
            font-size: 32px;
            color: #ff6b6b;
            margin: 0 0 10px 0;
        }

        #card-msg {
            font-size: 18px;
            color: #888;
            margin-bottom: 35px;
            padding: 0 20px;
            line-height: 1.6;
        }

        .btn-replay {
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e);
            color: white;
            border: none;
            padding: 16px 45px;
            border-radius: 100px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 25px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            font-family: 'Fredoka', sans-serif;
        }

        .btn-replay:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(255, 107, 107, 0.4);
        }
    </style>
</head>

<body>

    <div id="final-overlay"></div>
    <div id="final-card">
        <div class="card-icon">üíù</div>
        <h2 id="card-to">To: Jenny</h2>
        <p id="card-msg">love you 3000 times</p>
        <button class="btn-replay" onclick="celebrate()">Send More Love ‚ú®</button>
    </div>

    <script>
        // Define celebrate globally
        window.celebrate = function () {
            // 1. Play button sound effect (reusing popSound)
            if (popSound) {
                popSound.currentTime = 0; // Reset audio progress
                popSound.volume = 0.6;    // A bit louder
                popSound.play().catch(() => { });
            }

            // 2. Button interaction feedback (Turn green + change text)
            const btn = document.querySelector('.btn-replay');
            if (btn) {
                btn.innerHTML = "Love Accepted! üíñ";

                // === Modification started: Using premium honey peach gradient ===
                // btn.style.background = "linear-gradient(135deg, #43e97b 0%, #38f9d7 100%)"; // Removed this ugly green color
                // ‚¨áÔ∏è Replaced with this gentle premium gradient (Honey Peach)
                btn.style.background = "linear-gradient(to right, #FBD786, #f7797d)";
                // ‚¨áÔ∏è Glow effect also replaced with matching warm gold
                btn.style.boxShadow = "0 10px 25px rgba(247, 121, 125, 0.5)";
                // === Modification finished ===

                btn.disabled = true; // Prevent duplicate clicks
            }

            // 3. Launch fireworks (Fix Z-Index issue)
            if (typeof confetti === 'undefined') return;

            const duration = 3 * 1000;
            const end = Date.now() + duration;

            (function frame() {
                // Fireworks on the left
                confetti({
                    particleCount: 5,
                    angle: 60,
                    spread: 100,
                    origin: { x: 0 },
                    zIndex: 10000,
                    colors: ['#ff6b6b', '#ffb7b2', '#fdf6e3']
                });
                // Fireworks on the right
                confetti({
                    particleCount: 5,
                    angle: 120,
                    spread: 100,
                    origin: { x: 1 },
                    zIndex: 10000,
                    colors: ['#ff6b6b', '#ffb7b2', '#fdf6e3']
                });

                if (Date.now() < end) {
                    requestAnimationFrame(frame);
                }
            }());
        };

        // === 1. Macaron Palette (Background color, border color will be slightly darker) ===
        const palettes = [
            { bg: "#FFB7B2", text: "#FFFFFF" }, // Peach Pink
            { bg: "#FFDAC1", text: "#555555" }, // Apricot Yellow
            { bg: "#E2F0CB", text: "#555555" }, // Matcha Green
            { bg: "#B5EAD7", text: "#555555" }, // Mint Green
            { bg: "#C7CEEA", text: "#FFFFFF" }, // Blue Violet
            { bg: "#fff0f5", text: "#555555" }, // Pale Pink
            { bg: "#e0ffff", text: "#555555" }  // Pale Blue
        ];

        const wishes = [
            "Main Character Energy ‚ú®",
            "Manifesting this for u üïØÔ∏è",
            "100% Slay üíÖ",
            "Good vibes only ü™ê",
            "You glow different today ‚ú®",
            "Incoming Hugs üß∏",
            "Pov: You are loved ‚ù§Ô∏è",
            "Proud of you üåü",
            "Protect your peace üõ°Ô∏è",
            "Hot & Rich üí∞",
            "Bad vibes blocked üö´",
            "You deserve the world üåç",
            "Pure Magic ‚ú®",
            "Unstoppable üöÄ",
            "Ur sign to be happy ü¶ã",
            "You are the moment üíÖ",
            "Endless possibilities üåå",
            "Living your best life ü•Ç",
            "Stunning as always üíé",
            "Keep that energy ‚ö°",
            "Surrounded by love ‚òÅÔ∏è",
            "A literal icon üëë",
            "Dream big, babe ‚òÅÔ∏è",
            "Positive vibes loading... üîÑ",
            "You're doing amazing üåà",
            "Simply the best üèÜ",
            "Radiating happiness ‚òÄÔ∏è",
            "The world is yours üïäÔ∏è",
            "Magic in your eyes ‚ú®",
            "Soul full of sunshine üåª",
            "A whole vibe üåä",
            "Stay golden üçØ",
            "Fearless & Free ü¶Ö",
            "Wrapped in joy üéÅ",
            "Your smile > everything üíñ",
            "Born to shine üåü",
            "Limitless potential üöÄ",
            "Queen behavior üëë",
            "Love yourself first üå∏",
            "Golden hour glow ‚òÄÔ∏è"
        ];

        const emojis = ["üíñ", "üåà", "‚ú®", "üçì", "üß∏", "üéà", "üç≠", "üç¨", "üéÄ", "ü¶Ñ"];
        const popSound = new Audio('pop.mp3');

        // === 2. URL Parameter Retrieval (Supports Encryption) ===
        const params = new URLSearchParams(window.location.search);

        // Read parameters (supports ?to=xxx&msg=yyy)
        const toName = params.get('to') || 'Jenny';
        const mainMsg = params.get('msg') || 'Just a reminder: I love you! üíï';

        // After reading parameters, clear URL parameters from address bar
        history.replaceState(null, '', window.location.pathname);

        // === 3. Crazy Popup Logic ===
        let count = 0;
        const totalPopups = 150; // Adjusted count to 150
        const screenW = window.innerWidth;
        const screenH = window.innerHeight;

        function createPopup() {
            if (count >= totalPopups) {
                setTimeout(showFinalCard, 500);
                return;
            }

            const div = document.createElement('div');
            div.className = 'window';

            // Random Color Scheme
            const palette = palettes[Math.floor(Math.random() * palettes.length)];
            div.style.backgroundColor = palette.bg;
            div.style.color = palette.text;

            // Random rotation angle and scale
            const rotate = (Math.random() * 60 - 30).toFixed(2);
            const scale = (Math.random() * 0.4 + 0.8).toFixed(2); // Random scale between 0.8 and 1.2
            div.style.setProperty('--rotation', rotate + 'deg');
            div.style.setProperty('--scale', scale);

            // Random position (allows slight overlap to create stacking effect)
            const x = Math.random() * (screenW - 220); // Subtract width to prevent overflow
            const y = Math.random() * (screenH - 150);
            div.style.left = x + "px";
            div.style.top = y + "px";
            div.style.zIndex = 100 + count;

            // Random content
            const txt = wishes[Math.floor(Math.random() * wishes.length)];
            const emj = emojis[Math.floor(Math.random() * emojis.length)];

            div.innerHTML = `
                    <div class="window-header">
                        <div class="close-dot"></div>
                    </div>
                    <div class="window-body">
                        <div class="emoji">${emj}</div>
                        <div class="text">${txt}</div>
                    </div>
                `;

            document.body.appendChild(div);

            // Play pop sound every 3 popups
            if (count % 3 === 0) {
                popSound.currentTime = 0;
                popSound.play().catch(() => { });
            }

            // Trigger animation
            requestAnimationFrame(() => {
                div.classList.add('show');
            });

            count++;

            // === Speed Mode ===
            // Starts fast, becomes very fast in the middle, slows down slightly at the end
            // Random interval 50ms to 150ms, pops like a machine gun
            let nextTime = Math.random() * 50 + 30;
            setTimeout(createPopup, nextTime);
        }

        function showFinalCard() {
            const overlay = document.getElementById('final-overlay');
            const card = document.getElementById('final-card');

            document.getElementById('card-to').innerText = `To: ${toName}`;
            document.getElementById('card-msg').innerText = mainMsg;

            overlay.style.display = 'block';
            card.style.display = 'block';

            setTimeout(() => {
                overlay.style.opacity = '1';
                card.classList.add('show');
            }, 100);
        }



        // === Start ===
        window.onload = function () {
            setTimeout(createPopup, 300); // Start directly 0.3 seconds after page load
        };

    </script>
</body>

</html>